<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Статистика казино</title>

<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>

body{
background:#0f3b2f;
color:white;
font-family:Arial;
text-align:center;
}

/* layout */

.main{
display:flex;
justify-content:center;
gap:30px;
margin-top:20px;
}

/* roulette grid */

.table{
display:flex;
}

.zeros{
display:flex;
flex-direction:column;
}

.grid{
display:grid;
grid-template-columns: repeat(12,55px);
grid-template-rows: repeat(3,55px);
gap:3px;
}

/* buttons with WHITE BORDER */

button{
width:55px;
height:55px;
border:1px solid white;   /* ← БЕЛАЯ ОБВОДКА */
font-weight:bold;
color:white;
cursor:pointer;
box-sizing:border-box;
}

.red{
background:#c0392b;
border:1px solid white;
}

.black{
background:#111;
border:1px solid white;
}

.green{
background:#1e8449;
border:1px solid white;
}

/* stat boxes */

.statBox{
background:#111;
padding:10px;
width:200px;
border:1px solid white;
}

/* history */

.history{
display:flex;
flex-wrap:wrap;
gap:4px;
background:#111;
padding:10px;
margin-top:20px;
justify-content:center;
border:1px solid white;
}

.hist{
width:30px;
height:30px;
display:flex;
align-items:center;
justify-content:center;
font-size:12px;
border:1px solid white;
}

/* heatmap */

#heatmap{
display:grid;
grid-template-columns: repeat(12,40px);
gap:3px;
justify-content:center;
margin-top:20px;
}

.heat{
height:40px;
display:flex;
align-items:center;
justify-content:center;
font-size:12px;
font-weight:bold;
color:white;
border:1px solid white;
}

/* probability table */

#probTable{
display:grid;
grid-template-columns: repeat(10,60px);
gap:4px;
justify-content:center;
margin-top:10px;
}

#probTable div{
background:#222;
padding:5px;
font-size:12px;
border:1px solid white;
}

/* prediction */

#predictionList{
background:#111;
padding:10px;
width:200px;
border:1px solid white;
}

/* control buttons */

.control-btn{
background:black;
color:white;
padding:10px 20px;
border:1px solid white;
margin:5px;
cursor:pointer;
}

.control-btn:hover{
background:#222;
}

</style>
</head>
<body>

<h2>Статистика казино</h2>

<div class="table">

<div class="zeros">
<button class="green" onclick="addNumber('0')">0</button>
<button class="green" onclick="addNumber('00')">00</button>
</div>

<div class="grid" id="grid"></div>

</div>

<div class="history" id="history"></div>

<div id="predictionList">
<b>TOP-5 Prediction</b>
<div id="predictions"></div>
</div>

<h3>Heatmap</h3>
<div id="heatmap"></div>

<h3>Probability table</h3>
<div id="probTable"></div>

<br>

<button class="control-btn" onclick="exportExcel()">Excel</button>
<button class="control-btn" onclick="saveJSON()">Save JSON</button>
<button class="control-btn" onclick="importJSON()">Import JSON</button>
<button class="control-btn" onclick="clearAll()">Clear</button>

<input type="file" id="fileInput" hidden>

<script>

const redNums=[1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36];

let history=[];
let numberCount={};

for(let i=0;i<=36;i++) numberCount[i]=0;
numberCount["00"]=0;

/* create grid */

const grid=document.getElementById("grid");

for(let r=3;r>=1;r--){
for(let c=0;c<12;c++){

let n=r+c*3;

let btn=document.createElement("button");

btn.innerText=n;
btn.className=getColor(n);
btn.onclick=()=>addNumber(n);

grid.appendChild(btn);

}
}

/* color */

function getColor(n){
if(n=="0"||n=="00") return "green";
return redNums.includes(Number(n))?"red":"black";
}

/* add number */

function addNumber(n){

history.push({number:n,color:getColor(n)});
numberCount[n]++;

render();
saveLocal();

}

/* render */

function render(){

renderHistory();
updateHeatmap();
updateProbTable();
updatePredictions();

}

function renderHistory(){

let div=document.getElementById("history");
div.innerHTML="";

history.forEach(h=>{

let el=document.createElement("div");

el.className="hist "+h.color;
el.innerText=h.number;

div.appendChild(el);

});

}

/* heatmap */

function updateHeatmap(){

let h=document.getElementById("heatmap");
h.innerHTML="";

let total=history.length||1;

Object.keys(numberCount).forEach(n=>{

let prob=numberCount[n]/total;
let intensity=Math.floor(prob*255*3);

let el=document.createElement("div");

el.className="heat";
el.style.background=`rgb(${intensity},0,0)`;
el.innerText=n;

h.appendChild(el);

});

}

/* probability table */

function updateProbTable(){

let t=document.getElementById("probTable");
t.innerHTML="";

let total=history.length||1;

Object.keys(numberCount).forEach(n=>{

let el=document.createElement("div");
el.innerText=n+" "+((numberCount[n]/total)*100).toFixed(1)+"%";

t.appendChild(el);

});

}

/* prediction */

function updatePredictions(){

let total=history.length||1;

let arr=Object.keys(numberCount).map(n=>({
number:n,
prob:numberCount[n]/total
}));

arr.sort((a,b)=>b.prob-a.prob);

let top=arr.slice(0,5);

let div=document.getElementById("predictions");
div.innerHTML="";

top.forEach(x=>{
div.innerHTML+=x.number+" ("+(x.prob*100).toFixed(2)+"%)<br>";
});

}

/* storage */

function saveLocal(){
localStorage.setItem("roulette",JSON.stringify(history));
}

function loadLocal(){

let d=localStorage.getItem("roulette");

if(d){
JSON.parse(d).forEach(x=>addNumber(x.number));
}

}

loadLocal();

/* export */

function exportExcel(){

let ws=XLSX.utils.json_to_sheet(history);
let wb=XLSX.utils.book_new();

XLSX.utils.book_append_sheet(wb,ws,"history");

XLSX.writeFile(wb,"roulette.xlsx");

}

function saveJSON(){

let blob=new Blob([JSON.stringify(history)],{type:"application/json"});

let a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download="roulette.json";
a.click();

}

function importJSON(){
document.getElementById("fileInput").click();
}

document.getElementById("fileInput").onchange=function(e){

let reader=new FileReader();

reader.onload=function(){

clearAll();
JSON.parse(reader.result).forEach(x=>addNumber(x.number));

};

reader.readAsText(e.target.files[0]);

};

function clearAll(){

history=[];
for(let k in numberCount) numberCount[k]=0;

render();
saveLocal();

}

</script>

</body>
</html>